angular.module("easyTimepicker",["ui.bootstrap"]).constant("EasyTimepickerConfig",{minuteStep:15,showMeridian:!0,meridians:["AM","PM"],inputClass:"form-control",inputContainerClass:"input-group",showIcon:!0,clockIconClass:"icon-time",widgetColClass:"col-xs-4",incIconClass:"icon-chevron-up",decIconClass:"icon-chevron-down"}).directive("ezTimepicker",["EasyTimepickerConfig",function(a){return{restrict:"EA",replace:!0,templateUrl:"easy-timepicker.html",scope:{time:"=ezTimepicker"},link:function(b,c,d){b.minuteStep=parseInt(d.minuteStep,10)||a.minuteStep;var e=b.$eval(d.showMeridian);b.showMeridian=angular.isDefined(e)?e:a.showMeridian,b.meridians=d.meridians||a.meridians,b.inputClass=d.inputClass||a.inputClass,b.inputContainerClass=d.inputContainerClass||a.inputContainerClass;var f=b.$eval(d.showIcon);b.showIcon=angular.isDefined(f)?f:a.showIcon,b.clockIconClass=d.clockIconClass||a.clockIconClass,b.widgetColClass=d.widgetColClass||a.widgetColClass,b.incIconClass=d.incIconClass||a.incIconClass,b.decIconClass=d.decIconClass||a.decIconClass,b.widget={},c.find("input.time-input").attr("id",c.attr("id")),c.removeAttr("id"),b.updateFromInput=function(){n(b.time)},b.preventDefault=function(a){a.preventDefault(),a.stopPropagation()},b.incrementHours=function(){b.showMeridian?11===b.widget.hours?(b.widget.hours++,b.toggleMeridian()):12===b.widget.hours?b.widget.hours=1:b.widget.hours++:23===b.widget.hours?b.widget.hours=0:b.widget.hours++},b.decrementHours=function(){b.widget.hours--,0===b.widget.hours?b.widget.hours=b.showMeridian?12:23:11===b.widget.hours&&b.showMeridian&&b.toggleMeridian()},b.incrementMinutes=function(){b.widget.minutes=parseInt(b.widget.minutes,10)+b.minuteStep,b.widget.minutes>=60&&(b.widget.minutes=0,b.incrementHours()),g()},b.decrementMinutes=function(){b.widget.minutes=b.widget.minutes-b.minuteStep,parseInt(b.widget.minutes,10)<0&&(b.decrementHours(),b.widget.minutes+=60),g()},b.toggleMeridian=function(){b.widget.meridian=b.widget.meridian===b.meridians[0]?b.meridians[1]:b.meridians[0]};var g=function(){parseInt(b.widget.minutes,10)>=60&&(b.widget.minutes=0,b.incrementHours()),parseInt(b.widget.minutes,10)<10&&(b.widget.minutes="0"+parseInt(b.widget.minutes,10))},h=function(){b.time=b.widget.hours+":"+b.widget.minutes,b.showMeridian&&(b.time+=" "+b.widget.meridian)},i=function(){angular.isDefined(b.widget.hours)&&angular.isDefined(b.widget.minutes)?h():n(b.time)},j=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0},k=function(a){b.$apply(j(a)?b.incrementHours():b.decrementHours()),a.preventDefault()},l=function(a){b.$apply(j(a)?b.incrementMinutes():b.decrementMinutes()),a.preventDefault()},m=function(a){b.$apply(b.toggleMeridian()),a.preventDefault()},n=function(a){var c,d,e,f;a?(b.widget.meridian=a.match(new RegExp(b.meridians[1].substring(0,1),"i"))?b.meridians[1]:b.meridians[0],c=a.replace(/[^0-9\:]/g,"").split(":"),e=c[0]?c[0].toString():c.toString(),f=c[1]?c[1].toString():"",e.length>2&&(f=e.substr(2,2),e=e.substr(0,2)),f.length>2&&(f=f.substr(0,2)),e=parseInt(e,10),f=parseInt(f,10),isNaN(e)&&(e=0),isNaN(f)&&(f=0)):(d=new Date,e=d.getHours(),f=d.getMinutes(),b.widget.meridian=b.showMeridian&&e>=12?b.meridians[1]:b.meridians[0]),b.showMeridian?0===e?b.widget.hours=12:e>12?(b.widget.hours=e-12,b.widget.meridian=b.meridians[1]):b.widget.hours=e:b.widget.hours=e,b.widget.minutes=Math.ceil(f/b.minuteStep)*b.minuteStep,g(),h()};c.find(".hours-col").on("mousewheel wheel",k),c.find(".minutes-col").on("mousewheel wheel",l),c.find(".meridian-col").on("mousewheel wheel",m),b.$watch("widget",function(){i()},!0)}}}]);